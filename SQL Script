-- KPI's --
-- Total revenue --
SELECT SUM(total_price) AS Total_revenue
FROM pizza_sales;

-- Average order value --
SELECT SUM(total_price)/COUNT(DISTINCT order_id) AS avg_order_value
FROM pizza_sales;

-- Total pizzas sold --
SELECT SUM(quantity) AS total_pizzas_sold
FROM pizza_sales;

-- Total orders --
SELECT COUNT(DISTINCT order_id) AS Total_orders
FROM pizza_sales;

-- Average pizzas per order --
SELECT ROUND(SUM(quantity)/COUNT(DISTINCT order_id),2) AS avg_pizza_per_order
FROM pizza_sales;

-- Trends --
-- Daily trend -- 
SELECT dayname(order_date) AS order_day, COUNT(DISTINCT order_id) AS nbr_of_orders
FROM pizza_sales
GROUP BY 1
ORDER BY 2 DESC;

-- Hourly trend -- 
SELECT HOUR(order_time) AS order_hours, COUNT(DISTINCT order_id) AS nbr_of_orders
FROM pizza_sales
GROUP BY 1
ORDER BY 2 DESC;

-- Percentage of sales by pizza category for the whole year + best performance --
SELECT pizza_category, ROUND(SUM(total_price), 2) AS total_sales, ROUND((SUM(total_price) *100)/(SELECT SUM(TOTAL_PRICE) FROM pizza_sales), 2) AS percentage
FROM pizza_sales
GROUP BY 1
ORDER BY 3 DESC;

-- Percentage of sales by pizza category for the month of June --
SELECT pizza_category, ROUND(SUM(total_price), 2) AS sales, ROUND((SUM(total_price) *100)/(SELECT SUM(TOTAL_PRICE) FROM pizza_sales WHERE MONTH(order_date) = 6), 2) AS pct
FROM pizza_sales
WHERE MONTH(order_date) = 6
GROUP BY 1;

-- Percentage of sales by pizza size for the whole year + best performance --
SELECT pizza_size, ROUND(SUM(total_price), 2) AS total_sales, ROUND((SUM(total_price) *100)/(SELECT SUM(TOTAL_PRICE) FROM pizza_sales), 2) AS percentage
FROM pizza_sales
GROUP BY 1
ORDER BY 3 DESC;

-- How many types of pizza in each category --
SELECT pizza_category, COUNT(DISTINCT pizza_name) AS nbr_of_pizza_types
FROM pizza_sales
GROUP BY 1;

-- Total pizzas sold for each category --
SELECT pizza_category, SUM(quantity) AS quantity_sold
FROM pizza_sales
GROUP BY 1
ORDER BY 2 DESC;

-- Top 5 best selling pizzas by total pizzas sold --
SELECT pizza_name, SUM(quantity) AS total_pizzas_sold
FROM pizza_sales
GROUP BY 1
ORDER BY 2 DESC
LIMIT 5;

-- Least selling pizzas by total pizzas sold --
SELECT pizza_name, SUM(quantity) AS total_pizzas_sold
FROM pizza_sales
GROUP BY 1
ORDER BY 2
LIMIT 5;
